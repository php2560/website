{
    "collab_server" : "",
    "contents" : "---\ntitle: \"Homework 6\"\nauthor: ''\ndate: \"March 17, 2017\"\noutput: html_document\n---\n\n\n\n<style type=\"text/css\">\n.table {\n\n    width: 80%;\n    margin-left:10%; \n    margin-right:10%;\n}\n</style>\n\n\n```{r, include=FALSE}\n# knitr settings to control how R chunks work.\nrequire(knitr)\nopts_chunk$set(\n  cache=TRUE,\n  eval=FALSE,     # This hides theoutput\n  size=\"footnotesize\"    # slightly smaller font for code\n)\n            \n```\n\n## RMarkdown File\n\n[File](https://canvas.brown.edu/files/60922243/download?download_frd=1)\n\n## Compiling This\n\nThis will take awhile to compile. Remember to use survey methods as explained in lab 5a and 5b. Also start this assignment early. If you use the server, the file is already in the home directory as follows in the code. If you use your own laptop, create the \"BRFSS.rda\" file as done in the lab. \n\n## The Data\n\nWe will continue analyzing data from the Behavioral Risk Factor Surveillance System (BRFSS). This is a national health-related telephone survey. There are more than 400,000 interviews done every year from all 50 states and the district of Columbia. To learn more about this survey please go to their website: [Behavioral Risk Factor Surveillance System](http://www.cdc.gov/brfss/). \n\n\n* [Codebook](http://www.cdc.gov/brfss/annual_data/2014/pdf/codebook14_llcp.pdf)\n* [Data](https://drive.google.com/file/d/0B8CsRLdwqzbzd1RrRWp2RnBGTDg/view?usp=sharing)\n* [Variable Layout](http://www.cdc.gov/brfss/annual_data/2014/llcp_varlayout_14_onecolumn.html)\n\nWe will load our design file in that we worked with in the last lab. \n```{r, cache=TRUE}\nload(\"home/php2560/brfss.rda\")\n```\n\nWe will not list all the variables for this but instead will give you a copy of the question book that was used as well as the codebook which lists, the question, the variable name and what the data means. \n\n\n## Access to Healthcare\n\nOur question is to look over this data and try and understand access to health care in the US. Many disparities persist and to best inform ourselves as well as policies we need to understand what affects access to healthcare. Through the next series of labs and notes we will be focusing on the cost of health care as well as whether or not a subject has insurance. \n\nWe will not list out all of the variables but you will use the codebook to help find questions along with variable names and descriptions. A small list of initial variables considered follows below. \n\n\n---------------------------------------------------\nVariable      Description\n------------  -------------------------------------\nsex           Sex\n\nveteran3      Has person ever served in Military?\n\neduca         What is the highest level of education the person has obtained?\n\nchildren      How many children live in the household?\n\nemploy1       Are you currently employed?\n\nincome2       What is your household total income?\n\nimprace       Imputed Race\n\n\nage80         Imputed age\n\nhlthpln1      Health Insurance Coverage.\n\npersdoc2      Primary Care Doctor\n\nmedcost       Was the cost of medical care too expensive?\n--------------------------------------------------\n\n In lab we considered a model for whether cost was inhibitive. In homework our goal will be to build a model to understand whether someone has insurance or not. \n \n \\newpage\n \n\n1. Begin by building 9 simple logistic models like those in the lab. Consider `insurance` as the outcome in these models. \n\n2. Generate the the summary table of the models as done in lab. \n\n3. An aspect that was not considered in lab is that many times we treat certain categorical variables as a trend rather than just categories compared to a reference group. With a trend we say that as you move across groups the move from group 1 to group 2 is the same as the move from group 2 to group 3.  Consider `imprace`, `education`, and `pcp`. Can you consider all of these variables for a possible trend? Explain your reasoning. \n\n4. We move on to testing whether or not we can consider a trend with the variables you selected above. The way to do this is to build a new model with your categorical variable, say `cat.var` and we want to change this to numeric, `as.numeric(as.character(cat.var))`. We regress over this variable and then compare these models with a Likelihood Ratio test. \n\n```{r}\n#Replace cat.var with the correct variable\nlibrary(lmtest)\nlibrary(survival)\n\nmodel <- svyglm(insurance~cat.var, design=brfss.design, family=\"binomial\")\nmodel.a <- svyglm(insurance~as.numeric(as.character(cat.var)), design=brfss.design,\n                  family=\"binomial\")\nlrtest(model,model.a)\n```\n\n\n5. If you are now able to use the variable as a trend rather than a categorical variable we want to tell R to do this. \n```{r}\n#Replace cat.var with the correct variable\nbrfss.design <- update(brfss.design, as.numeric(as.character(cat.var)) )\n```\n\n\n\n6. We then move onto to building a multiple logistic regression. Use the following selection methods to build a multiple logistic model for `insurance`. Use all of the variables you used in problem 1 as possible variables to include in the model. We will do this with stepwise AIC selection\n \n\n\n7. Display summary tables for both models.\n\n\n8. Do the estimates of the variables included in this model remain similar to their estimates in simple logistic regression? If not, what has changed? \n\n\n9.  Perform a Hosmer- Lemeshew test for Goodness-of-fit. Remember the number of groups should be larger than the number of variables in the model. \n    a. State the Hypothesis.\n    b. What is your conclusion?\n    c. Does this change if you change the bin size?\n\n```{r}\nsuppressMessages(library(ResourceSelection))\nhoslem.test(brfss.design$variables$cost, fitted(model), g=20)\n```\n\n10. Another test we can use is a chi-square deviance goodness-of-fit test.\n    a. State the hypothesis.\n    b. What is your conclusion?\n```{r}\npchisq(model$deviance, df=model$df.residual, lower.tail=FALSE)\n```\n\n\n11. Create an ROC curve for this data. \n    a. What is the AUC?\n    b. What is your conclusion?\n```{r, eval=FALSE}\nsuppressMessages(library(ggplot2))\nsuppressMessages(library(ROCR))\n\n\nprob <- predict(model, type='response')\npred <- prediction(as.vector(prob), brfss.design$variables$cost)\nperf <- performance(pred, \"tpr\", \"fpr\")\n# I know, the following code is bizarre. Just go with it.\nauc <- performance(pred, measure = \"auc\")\nauc <- auc@y.values[[1]]\n\nroc.data <- data.frame(fpr=unlist(perf@x.values),\n                       tpr=unlist(perf@y.values),\n                       model=\"GLM\")\nggplot(roc.data, aes(x=fpr, ymin=0, ymax=tpr)) +\n  geom_ribbon(alpha=0.2) + geom_abline(intercept = 0, slope = 1, colour = \"gray\")+\n  geom_line(aes(y=tpr)) +\n  ggtitle(paste0(\"ROC Curve w/ AUC=\", auc))\n```\n\n\n\n12. What can you conclude about the fit that we have here? \n\n\n\n\n",
    "created" : 1491705028958.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3601849976",
    "id" : "8369B031",
    "lastKnownWriteTime" : 1491705672,
    "last_content_update" : 1491705672736,
    "path" : "C:/Users/adam_/Dropbox/Brown/PHP2511/Spring2017/HW/php2511_hw6.Rmd",
    "project_path" : null,
    "properties" : {
    },
    "relative_order" : 15,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_markdown"
}